SELECT
PRO.CODPROD,
INI.QTD AS INI,
ENT.QTD AS ENT,
SAI.QTD AS SAI,
(INI.QTD + ENT.QTD - SAI.QTD) AS QTD


FROM
TGFPRO PRO
/* SALDO INICIAL */ LEFT JOIN (SELECT
ITE.CODPROD,
SUM (ITE.QTDNEG) AS QTD
FROM
TGFITE ITE
WHERE
ITE.NUNOTA IN (30486,262,366,396,399,475,4272,550,608,777,896,1397,2680,6880,7346)
AND ITE.CODEMP = '1'
GROUP BY
ITE.CODPROD
) INI ON PRO.CODPROD = INI.CODPROD


/* SALDO SAIDA */ LEFT JOIN (SELECT
ITE.CODPROD,
SUM (ITE.QTDNEG) AS QTD
FROM
TGFITE ITE,
TGFCAB CAB
WHERE
ITE.NUNOTA = CAB.NUNOTA
AND CAB.CODTIPOPER IN (3001,3006,3007,3200,3202,3203,3204,3208,3209,3210,3206,3211,3213,3214,3260,3262,3297)
AND ITE.CODEMP = :EMP
AND CAB.DTNEG BETWEEN :PERIODO.INI AND :PERIODO.FIN
GROUP BY
ITE.CODPROD
) SAI ON PRO.CODPROD = SAI.CODPROD


/* SALDO FINAL */ LEFT JOIN (SELECT
ITE.CODPROD,
SUM (ITE.QTDNEG) AS QTD
FROM
TGFITE ITE,
TGFCAB CAB
WHERE
ITE.NUNOTA = CAB.NUNOTA
AND CAB.CODTIPOPER IN (2100,2103,2104,2105,2107,2110,2113,2117,2119,2120,2122,2124,2125,2126,2128,2130,2131,2132,2160,2200,2201,2204,2209,2210,2211,2260,2262)
AND ITE.CODEMP = :EMP
AND CAB.DTNEG BETWEEN :PERIODO.INI AND :PERIODO.FIN
GROUP BY
ITE.CODPROD
) ENT ON PRO.CODPROD = ENT.CODPROD

WHERE
PRO.USOPROD = 'R'