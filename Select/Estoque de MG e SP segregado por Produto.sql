SELECT
PRO.CODPROD,
PRO.DESCRPROD,
MG.ESTOQUE AS ESTQ_MG,
SP.ESTOQUE AS ESTQ_SP,
PE.ESTOQUE AS ESTQ_PE

FROM
TGFPRO PRO
LEFT JOIN (SELECT
    EST.CODPROD,
    PRO.DESCRPROD AS DESCRICAO,
    SUM(EST.ESTOQUE) AS ESTOQUE
    FROM 
    TGFEST EST
    JOIN TGFPRO PRO ON EST.CODPROD = PRO.CODPROD
    JOIN TGFLOC LOC ON EST.CODLOCAL = LOC.CODLOCAL
    WHERE
    EST.ESTOQUE > '0' AND PRO.USOPROD IN ('R') AND EST.CODEMP = '3'
    AND EST.CODLOCAL NOT IN ('10480000','10390000','10370000','10450000','10420000','10470000','10010000','10380000','14200000','20020000','30010000','30050000','10020000','10440000','20260000','10081300','20010000','30070000')
    GROUP BY
    EST.CODPROD,
    PRO.DESCRPROD) MG ON MG.CODPROD = PRO.CODPROD
LEFT JOIN (SELECT
    EST.CODPROD,
    PRO.DESCRPROD AS DESCRICAO,
    SUM(EST.ESTOQUE) AS ESTOQUE
    FROM 
    TGFEST EST
    JOIN TGFPRO PRO ON EST.CODPROD = PRO.CODPROD
    JOIN TGFLOC LOC ON EST.CODLOCAL = LOC.CODLOCAL
    WHERE
    EST.ESTOQUE > '0' AND PRO.USOPROD IN ('R') AND EST.CODEMP IN ('1','2')
    AND EST.CODLOCAL NOT IN ('10480000','10390000','10370000','10450000','10420000','10470000','10010000','10380000','14200000','20020000','30010000','30050000','10020000','10440000','20260000','10081300','20010000','30070000')
    GROUP BY
    EST.CODPROD,
    PRO.DESCRPROD) SP ON SP.CODPROD = PRO.CODPROD
LEFT JOIN (SELECT
    EST.CODPROD,
    PRO.DESCRPROD AS DESCRICAO,
    SUM(EST.ESTOQUE) AS ESTOQUE
    FROM 
    TGFEST EST
    JOIN TGFPRO PRO ON EST.CODPROD = PRO.CODPROD
    JOIN TGFLOC LOC ON EST.CODLOCAL = LOC.CODLOCAL
    WHERE
    EST.ESTOQUE > '0' AND PRO.USOPROD IN ('R') AND EST.CODEMP IN ('4')
    GROUP BY
    EST.CODPROD,
    PRO.DESCRPROD) PE ON PE.CODPROD = PRO.CODPROD
    
WHERE
PRO.USOPROD = 'R'
AND SP.ESTOQUE <> '0' OR MG.ESTOQUE <> '0' OR PE.ESTOQUE <> '0'
