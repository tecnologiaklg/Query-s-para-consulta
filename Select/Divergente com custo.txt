SELECT
MAX(CUS.DTATUAL),
CUS.CUSREP,
EST.CODPROD,
PRO.DESCRPROD AS DESCRICAO,
EST.CODEMP,
EST.ESTOQUE AS ESTOQUE,
EST.CODLOCAL,
LOC.DESCRLOCAL,
EST.CONTROLE


FROM 
TGFEST EST
JOIN TGFPRO PRO ON EST.CODPROD = PRO.CODPROD
JOIN TGFLOC LOC ON EST.CODLOCAL = LOC.CODLOCAL
JOIN TGFCUS CUS ON EST.CODPROD = CUS.CODPROD AND EST.CONTROLE = CUS.CONTROLE


WHERE
EST.ESTOQUE > '0' AND PRO.USOPROD IN ('R','M') AND EST.CODEMP = '1' AND EST.CODLOCAL = '10420000'

GROUP BY
CUS.CUSREP,
EST.CODPROD,
PRO.DESCRPROD,
EST.CODEMP,
EST.ESTOQUE,
EST.CODLOCAL,
LOC.DESCRLOCAL,
EST.CONTROLE

